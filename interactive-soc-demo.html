<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive AI SOC Demo - With Live Q&A</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
        }

        .navbar {
            background-color: #111111;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #333;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 600;
            background: linear-gradient(45deg, #00ff88, #00aaff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 65px);
        }

        .sidebar {
            width: 320px;
            background-color: #111111;
            border-right: 1px solid #333;
            overflow-y: auto;
            padding: 20px;
        }

        .scenario-card {
            padding: 15px;
            margin-bottom: 10px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scenario-card:hover {
            border-color: #00ff88;
            transform: translateX(5px);
        }

        .scenario-card.active {
            background: #002b36;
            border-color: #00ff88;
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0a0a0a;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .message {
            margin-bottom: 20px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-user {
            background: #1a1a1a;
            border-left: 3px solid #00aaff;
            padding: 15px;
            border-radius: 8px;
        }

        .message-ai {
            background: #111;
            border-left: 3px solid #00ff88;
            padding: 15px;
            border-radius: 8px;
        }

        .chat-input-container {
            padding: 20px;
            background: #111;
            border-top: 1px solid #333;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            background: #1a1a1a;
            border: 1px solid #333;
            color: white;
            padding: 12px 15px;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
        }

        .chat-input:focus {
            border-color: #00ff88;
        }

        .send-button {
            background: linear-gradient(45deg, #00ff88, #00aaff);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .send-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-indicator {
            display: none;
            padding: 10px;
            text-align: center;
            color: #00ff88;
        }

        .loading-indicator.active {
            display: block;
        }

        .typing-dots {
            display: inline-flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
        }

        .agent-response {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #00ff88;
            font-weight: 600;
        }

        .code-block {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .api-key-setup {
            background: #1a1a1a;
            border: 2px solid #00ff88;
            border-radius: 8px;
            padding: 20px;
            margin: 20px;
        }

        .api-key-input {
            width: 100%;
            background: #0a0a0a;
            border: 1px solid #333;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="logo">
            <span style="font-size: 30px;">üõ°Ô∏è</span>
            <span class="logo-text">Interactive AI SOC Demo</span>
        </div>
        <div style="color: #888; font-size: 12px;">
            Live Q&A Powered by LLM
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <h3 style="margin-bottom: 20px; color: #00ff88;">Select Scenario</h3>

            <div class="scenario-card active" data-scenario="lateral-movement">
                <div style="font-size: 20px; margin-bottom: 8px;">üß†</div>
                <div style="font-weight: 600; margin-bottom: 5px;">Lateral Movement Detection</div>
                <div style="font-size: 12px; color: #888;">APT detection in 5G infrastructure</div>
            </div>

            <div class="scenario-card" data-scenario="insider-threat">
                <div style="font-size: 20px; margin-bottom: 8px;">üë§</div>
                <div style="font-weight: 600; margin-bottom: 5px;">Insider Threat Detection</div>
                <div style="font-size: 12px; color: #888;">Behavioral analytics & risk scoring</div>
            </div>

            <div class="scenario-card" data-scenario="zero-day">
                <div style="font-size: 20px; margin-bottom: 8px;">üîç</div>
                <div style="font-weight: 600; margin-bottom: 5px;">Zero-Day Detection</div>
                <div style="font-size: 12px; color: #888;">Unknown threat identification</div>
            </div>

            <div class="scenario-card" data-scenario="phishing">
                <div style="font-size: 20px; margin-bottom: 8px;">üé£</div>
                <div style="font-weight: 600; margin-bottom: 5px;">Phishing Triage</div>
                <div style="font-size: 12px; color: #888;">Automated email threat analysis</div>
            </div>

            <div class="scenario-card" data-scenario="cloud-security">
                <div style="font-size: 20px; margin-bottom: 8px;">‚òÅÔ∏è</div>
                <div style="font-weight: 600; margin-bottom: 5px;">Cloud Security</div>
                <div style="font-size: 12px; color: #888;">Cloud misconfiguration detection</div>
            </div>
        </div>

        <div class="content">
            <div class="api-key-setup" id="apiKeySetup">
                <h3 style="color: #00ff88; margin-bottom: 10px;">üîë Configure API Key for Live Q&A</h3>
                <p style="font-size: 14px; color: #888; margin-bottom: 15px;">
                    Enter your OpenAI API key to enable interactive Q&A. The key is stored locally in your browser.
                </p>
                <input type="password" class="api-key-input" id="apiKeyInput" placeholder="sk-...">
                <button class="send-button" onclick="saveApiKey()">Save API Key</button>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                    Or use the backend server at http://localhost:3001 if running
                </p>
            </div>

            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message message-ai">
                        <div class="agent-response">
                            <div class="agent-header">
                                <span>ü§ñ</span>
                                <span>AI SOC Assistant</span>
                            </div>
                            <div>
                                Welcome to the Interactive AI SOC Demo! I'm your AI Security Analyst.
                                Select a scenario from the left, and ask me any questions about:
                                <ul style="margin: 10px 0 0 20px; font-size: 14px; color: #aaa;">
                                    <li>Threat detection techniques</li>
                                    <li>Attack patterns and indicators</li>
                                    <li>Response strategies</li>
                                    <li>Technical details about the scenario</li>
                                    <li>Best practices and recommendations</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="loading-indicator" id="loadingIndicator">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    AI is analyzing...
                </div>

                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <input
                            type="text"
                            class="chat-input"
                            id="chatInput"
                            placeholder="Ask about the security scenario..."
                            onkeypress="handleKeyPress(event)"
                        >
                        <button class="send-button" id="sendButton" onclick="sendMessage()">
                            Send
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentScenario = 'lateral-movement';
        let conversationHistory = [];
        let apiKey = localStorage.getItem('openai_api_key');
        let useBackend = false; // Set to true if backend is running

        // Scenario contexts for client-side processing
        const scenarioContexts = {
            'lateral-movement': {
                name: 'Lateral Movement Detection',
                context: `You are an expert AI SOC analyst specializing in lateral movement detection in telecommunications networks. You have deep knowledge of:
                - Cyber Kill Chain methodology and its 7 phases
                - 5G network architecture including AMF, SMF, UPF, PCF, NEF components
                - APT (Advanced Persistent Threat) tactics and techniques
                - GTP (GPRS Tunneling Protocol) and Diameter signaling vulnerabilities
                - Network segmentation and microsegmentation strategies
                - Zero-trust security principles in telco environments

                Current scenario: An APT group has been detected performing lateral movement through a 5G core network, having compromised initial access through a supply chain attack on vendor management systems.`
            },
            'insider-threat': {
                name: 'Insider Threat Detection',
                context: `You are an expert AI SOC analyst specializing in insider threat detection. You monitor and analyze:
                - User and Entity Behavior Analytics (UEBA)
                - Privileged access management (PAM) violations
                - Data loss prevention (DLP) alerts
                - Abnormal access patterns and time-based anomalies
                - Psychological indicators and risk scoring models

                Current scenario: A privileged telco administrator account is showing suspicious behavior patterns including unusual data access, off-hours activity, and attempts to disable logging.`
            },
            'zero-day': {
                name: 'Zero-Day Detection',
                context: `You are an expert AI SOC analyst specializing in zero-day threat detection. You analyze:
                - Unknown vulnerabilities and exploit patterns
                - Behavioral sandboxing results
                - Memory forensics and heap spray detection
                - Anomalous system calls and API usage
                - Machine learning-based anomaly detection

                Current scenario: A potential zero-day exploit has been detected targeting the OSS/BSS systems, showing signs of memory corruption and privilege escalation.`
            },
            'phishing': {
                name: 'Phishing Triage',
                context: `You are an expert AI SOC analyst specializing in phishing and email security. You analyze:
                - Email header analysis and SPF/DKIM/DMARC validation
                - URL reputation and sandboxing
                - Attachment analysis and malware detection
                - Social engineering tactics and psychological triggers
                - Business Email Compromise (BEC) patterns

                Current scenario: A sophisticated phishing campaign is targeting telco employees with fake vendor portal updates containing credential harvesters.`
            },
            'cloud-security': {
                name: 'Cloud Security',
                context: `You are an expert AI SOC analyst specializing in cloud security. You monitor:
                - Cloud Security Posture Management (CSPM)
                - Infrastructure as Code (IaC) security
                - Container and Kubernetes security
                - Serverless function vulnerabilities
                - Multi-cloud compliance and governance

                Current scenario: Multiple cloud misconfigurations have been detected in the telco's AWS and Azure environments, including exposed S3 buckets and overly permissive IAM roles.`
            }
        };

        // Check if API key is saved
        if (apiKey) {
            document.getElementById('apiKeySetup').style.display = 'none';
        }

        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value;
            if (key) {
                localStorage.setItem('openai_api_key', key);
                apiKey = key;
                document.getElementById('apiKeySetup').style.display = 'none';
                addMessage('ai', 'API key configured successfully! You can now ask questions about the security scenarios.');
            }
        }

        // Handle scenario selection
        document.querySelectorAll('.scenario-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.scenario-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                currentScenario = this.dataset.scenario;
                conversationHistory = []; // Reset conversation for new scenario

                const scenario = scenarioContexts[currentScenario];
                addMessage('ai', `Switched to <strong>${scenario.name}</strong> scenario. Ask me anything about this security situation!`);
            });
        });

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            if (!apiKey && !useBackend) {
                addMessage('ai', 'Please configure your API key first to enable interactive Q&A.');
                return;
            }

            // Add user message to chat
            addMessage('user', message);

            // Clear input and disable send button
            input.value = '';
            document.getElementById('sendButton').disabled = true;
            document.getElementById('loadingIndicator').classList.add('active');

            try {
                let response;

                if (useBackend) {
                    // Use backend server
                    response = await fetchFromBackend(message);
                } else {
                    // Use OpenAI directly
                    response = await fetchFromOpenAI(message);
                }

                // Add AI response to chat
                addMessage('ai', response);

                // Add to conversation history
                conversationHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: response }
                );

                // Keep conversation history manageable
                if (conversationHistory.length > 10) {
                    conversationHistory = conversationHistory.slice(-10);
                }

            } catch (error) {
                console.error('Error:', error);
                addMessage('ai', `Error: ${error.message}. Please check your API key or try again.`);
            } finally {
                document.getElementById('sendButton').disabled = false;
                document.getElementById('loadingIndicator').classList.remove('active');
            }
        }

        async function fetchFromOpenAI(message) {
            const scenario = scenarioContexts[currentScenario];

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4',
                    messages: [
                        {
                            role: 'system',
                            content: scenario.context + '\n\nProvide detailed, technical responses as an expert SOC analyst. Use specific examples, mention relevant tools (Splunk, CrowdStrike, etc.), and include actionable recommendations.'
                        },
                        ...conversationHistory,
                        {
                            role: 'user',
                            content: message
                        }
                    ],
                    temperature: 0.7,
                    max_tokens: 800
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'API request failed');
            }

            const data = await response.json();
            return formatResponse(data.choices[0].message.content);
        }

        async function fetchFromBackend(message) {
            const response = await fetch('http://localhost:3001/api/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    question: message,
                    scenario: currentScenario,
                    conversationHistory: conversationHistory
                })
            });

            const data = await response.json();
            if (!data.success) {
                throw new Error(data.error);
            }

            return data.response;
        }

        function formatResponse(text) {
            // Format the response with agent-like styling
            return `
                <div class="agent-response">
                    <div class="agent-header">
                        <span>üß†</span>
                        <span>AI SOC Analyst</span>
                    </div>
                    <div>${text.replace(/\n/g, '<br>')}</div>
                </div>
            `;
        }

        function addMessage(type, content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;

            if (type === 'user') {
                messageDiv.innerHTML = `<strong>You:</strong> ${content}`;
            } else {
                messageDiv.innerHTML = content;
            }

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Sample questions for quick testing
        const sampleQuestions = [
            "What are the key indicators of lateral movement in this attack?",
            "How can we detect GTP protocol exploitation?",
            "What tools should we use to investigate this threat?",
            "What are the recommended containment strategies?",
            "How do we prevent similar attacks in the future?"
        ];

        // Add sample questions on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                addMessage('ai', `
                    <div style="margin-top: 10px; padding: 10px; background: #1a1a1a; border-radius: 8px;">
                        <strong>Sample questions to get started:</strong>
                        <ul style="margin: 10px 0 0 20px; font-size: 14px; color: #00ff88;">
                            ${sampleQuestions.map(q => `<li style="cursor: pointer; margin: 5px 0;" onclick="document.getElementById('chatInput').value='${q}'">${q}</li>`).join('')}
                        </ul>
                        <small style="color: #666;">Click any question to use it</small>
                    </div>
                `);
            }, 1000);
        });
    </script>
</body>
</html>